<div class="bf-container crud">
  <mat-card>
    <div class="card-crud">
      <mat-tab-group [selectedIndex]="selected.value" (selectedIndexChange)="selected.setValue($event)" dynamicHeight>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mat-icon-tabs" color="primary">work_outline</mat-icon>
            <span class="example-tab-text"> Dados </span>
          </ng-template>
          <div class="form-crud">
            <app-form [(form)]="catalogForm" [model]="model" [formRows]="form">
            </app-form>
          </div>
        </mat-tab>

        <mat-tab *ngIf="editId">
          <ng-template mat-tab-label>
            <mat-icon class="mat-icon-tabs" color="primary">payments</mat-icon>
            <span class="example-tab-text">Conds. pagamento</span>
          </ng-template>
          <div class="form-crud">

            <div *ngIf="(paymentsDirectLists == null || paymentsDirectLists.length < 1) && (paymentsLists == null || paymentsLists.length < 1)" class="div-alert">
              <h2>Não há condições de pagamento vinculadas ao cadastro do fornecedor.</h2>
            </div>

            <mat-tab-group dynamicHeight>
              <mat-tab *ngIf="paymentsDirectLists != null && paymentsDirectLists.length > 0">
                <ng-template mat-tab-label>
                  <mat-icon class="mat-icon-tabs" color="primary">card_travel</mat-icon>
                  <span class="example-tab-text">Negociação direta com a empresa vendedora</span>
                </ng-template>

                <mat-card class="card-payment" *ngFor="let rows of paymentsDirectLists">
                  <mat-card-title>{{rows.name}}</mat-card-title>
                  <mat-card-content>
                    <div class="payment-type">
                      <mat-card class="card-item-payment crud-grid-container">

                        <div class="grid">
                          <table class="mat-table table-scroll">
                            <thead>
                              <tr>
                                <th class="td-center">...</th>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                                <th>Dias p/Pagto</th>
                                <th>Qtd/Parcelas</th>
                                <th>Percentual</th>
                                <th class="td-center" style="width: 225px;">Ação</th>
                              </tr>
                            </thead>
                            <tbody *ngFor="let row of rows.paymentConditions">
                              <tr
                                [class]="(row.id > 0 && row.active) ? 'tr-selected' : (row.id > 0 && !row.active) ? 'tr-unselected' : ''">
                                <td class="td-action">
                                  <mat-icon *ngIf="(row.id == null)" color="warn" matTooltip="Não vinculado">remove
                                  </mat-icon>
                                  <mat-icon *ngIf="(row.id > 0 && row.active)" color="primary" matTooltip="Vinculado">
                                    task_alt
                                  </mat-icon>
                                  <mat-icon *ngIf="(row.id > 0 && !row.active)" color="warn"
                                    matTooltip="Vinculado e inativo">
                                    radio_button_unchecked</mat-icon>
                                </td>
                                <td>{{row.name}}</td>
                                <td>{{row.maturityDateTypeName}}</td>
                                <td>{{row.maturityDateTypeDescription}}</td>
                                <td>{{row.daysByPayment}}</td>
                                <td>{{row.quantityInstallments}}</td>
                                <td>{{row.percentageOnPrice| currency:'':''}}</td>
                                <td *ngIf="allowEntry" class="td-action">
                                  <button mat-raised-button class="shrink-2x btn-margin-3"
                                    [color]="(row.id > 0 && row.active) ? 'warn' : 'info'"
                                    [style.color]="row.id == null ? 'var(--theme-primary-500)' :  (row.id > 0 && row.active) ? 'white' : ''"
                                    (click)="paymentConditionActive(row)">{{
                                    row.id == null ? 'Vincular' : (row.id > 0 && row.active) ? 'Inativar' : 'Ativar'}}
                                  </button>
                                  <button *ngIf="(row.id > 0 && row.active)" class="shrink-2x" mat-raised-button
                                    color="primary" [style.color]="'white'" (click)="showModalConfigPayment(row)">
                                    <mat-icon>settings</mat-icon>Configurar
                                  </button>
                                </td>
                                <td *ngIf="!allowEntry" >
                                  ...
                                </td>
                              </tr>
                              <tr *ngIf="row.specialConditions && row.specialConditions.length > 0">
                                <td class="td-right">
                                  <mat-icon
                                    [ngClass]="(row.id > 0 && row.active) ? 'icon-special' : 'icon-special-inactive'">
                                    bookmark_added</mat-icon>
                                </td>
                                <td colspan="7" class="">
                                  <table
                                    [ngClass]="(row.id > 0 && row.active) ? 'mat-table table-scroll table-special' : 'mat-table table-scroll table-special-inactive'">
                                    <thead>
                                      <th>Tipo</th>
                                      <th>Conds. especial</th>
                                      <th>Percentual</th>
                                      <th>Data Inicial</th>
                                      <th>Data Final</th>
                                    </thead>
                                    <tbody *ngFor="let srow of row.specialConditions">
                                      <tr>
                                        <td>{{srow.restrictType}}</td>
                                        <td>{{srow.restrict}}</td>
                                        <td>{{srow.percentageOnPrice| currency:'':''}}</td>
                                        <td>{{srow.startDate| date:'dd/MM/yyyy'}}</td>
                                        <td>{{srow.expirationDate| date:'dd/MM/yyyy'}}</td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>

                      </mat-card>
                    </div>
                  </mat-card-content>
                </mat-card>
              </mat-tab>

              <mat-tab *ngIf="paymentsLists != null && paymentsLists.length > 0">
                <ng-template mat-tab-label>
                  <mat-icon class="mat-icon-tabs" color="primary">credit_card</mat-icon>
                  <span class="example-tab-text">Meio de Pagamento</span>
                </ng-template>
                
                <mat-card class="card-payment" *ngFor="let rows of paymentsLists">
                  <mat-card-title>{{rows.name}}</mat-card-title>
                  <mat-card-content>
                    <div class="payment-type">
                      <mat-card class="card-item-payment crud-grid-container">

                        <div class="grid">
                          <table class="mat-table table-scroll">
                            <thead>
                              <tr>
                                <th class="td-center">...</th>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                                <th>Dias p/Pagto</th>
                                <th>Qtd/Parcelas</th>
                                <th>Percentual</th>
                                <th class="td-center" style="width: 225px;">Ação</th>
                              </tr>
                            </thead>
                            <tbody *ngFor="let row of rows.paymentConditions">
                              <tr
                                [class]="(row.id > 0 && row.active) ? 'tr-selected' : (row.id > 0 && !row.active) ? 'tr-unselected' : ''">
                                <td class="td-action">
                                  <mat-icon *ngIf="(row.id == null)" color="warn" matTooltip="Não vinculado">remove
                                  </mat-icon>
                                  <mat-icon *ngIf="(row.id > 0 && row.active)" color="primary" matTooltip="Vinculado">
                                    task_alt
                                  </mat-icon>
                                  <mat-icon *ngIf="(row.id > 0 && !row.active)" color="warn"
                                    matTooltip="Vinculado e inativo">
                                    radio_button_unchecked</mat-icon>
                                </td>
                                <td>{{row.name}}</td>
                                <td>{{row.maturityDateTypeName}}</td>
                                <td>{{row.maturityDateTypeDescription}}</td>
                                <td>{{row.daysByPayment}}</td>
                                <td>{{row.quantityInstallments}}</td>
                                <td>{{row.percentageOnPrice| currency:'':''}}</td>
                                <td *ngIf="allowEntry" class="td-action">
                                  <button mat-raised-button class="shrink-2x btn-margin-3"
                                    [color]="(row.id > 0 && row.active) ? 'warn' : 'info'"
                                    [style.color]="row.id == null ? 'var(--theme-primary-500)' :  (row.id > 0 && row.active) ? 'white' : ''"
                                    (click)="paymentConditionActive(row)">{{
                                    row.id == null ? 'Vincular' : (row.id > 0 && row.active) ? 'Inativar' : 'Ativar'}}
                                  </button>
                                  <button *ngIf="(row.id > 0 && row.active)" class="shrink-2x" mat-raised-button
                                    color="primary" [style.color]="'white'" (click)="showModalConfigPayment(row)">
                                    <mat-icon>settings</mat-icon>Configurar
                                  </button>
                                </td>
                                <td *ngIf="!allowEntry" >
                                  ...
                                </td>
                              </tr>
                              <tr *ngIf="row.specialConditions && row.specialConditions.length > 0">
                                <td class="td-right">
                                  <mat-icon
                                    [ngClass]="(row.id > 0 && row.active) ? 'icon-special' : 'icon-special-inactive'">
                                    bookmark_added</mat-icon>
                                </td>
                                <td colspan="7" class="">
                                  <table
                                    [ngClass]="(row.id > 0 && row.active) ? 'mat-table table-scroll table-special' : 'mat-table table-scroll table-special-inactive'">
                                    <thead>
                                      <th>Tipo</th>
                                      <th>Conds. especial</th>
                                      <th>Percentual</th>
                                      <th>Data Inicial</th>
                                      <th>Data Final</th>
                                    </thead>
                                    <tbody *ngFor="let srow of row.specialConditions">
                                      <tr>
                                        <td>{{srow.restrictType}}</td>
                                        <td>{{srow.restrict}}</td>
                                        <td>{{srow.percentageOnPrice| currency:'':''}}</td>
                                        <td>{{srow.startDate| date:'dd/MM/yyyy'}}</td>
                                        <td>{{srow.expirationDate| date:'dd/MM/yyyy'}}</td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>

                      </mat-card>
                    </div>
                  </mat-card-content>
                </mat-card>

              </mat-tab>
            </mat-tab-group>

          </div>
        </mat-tab>

        <mat-tab *ngIf="editId">
          <ng-template mat-tab-label>
            <mat-icon class="mat-icon-tabs" color="warn">block</mat-icon>
            <span class="example-tab-text"> Restrições <span class="total-records no-match">{{ !blackLists ? 0 :
                blackLists.length }}</span>
            </span>
          </ng-template>
          <div class="form-restrict">
            <div class="div-restrict-opt">
              <h4>Forma de restrição:</h4>
              <mat-radio-group aria-labelledby="radio-group-label" [(ngModel)]="restrictConditionType">
                <mat-radio-button [value]="1" (change)="radioButtonChange($event)">Regiões</mat-radio-button>
                <mat-radio-button [value]="2" (change)="radioButtonChange($event)">CNPJ</mat-radio-button>
              </mat-radio-group>
            </div>
            <div class="div-restrict-form">
              <app-form *ngIf="restrictConditionType == 1" [(form)]="blackListFormRegion" [model]="modelRestrict"
                [formRows]="formBlackListRegion" [useErrors]="false" (onSubmit)="formBlackListSubmit()"></app-form>
              <app-form *ngIf="restrictConditionType == 2" [(form)]="blackListFormCnpj" [model]="modelRestrict"
                [formRows]="formBlackListCnpj" [useErrors]="false" (onSubmit)="formBlackListSubmit()"></app-form>
            </div>
          </div>

          <app-grid *ngIf="blackLists != null" [ableEdit]="false" [alwaysFilters]="true" [columns]="colsBlackList"
            [displayedColumns]="displayedColumnsBlackList" [itemMenus]="itemMenusBlackList"
            [modelIdentity]="modelBlackList" [rows]="blackLists" [title]="gridBlackList" [useFilters]="false"
            [usePagination]="false" [useRegister]="false" [useSelect]="false">
          </app-grid>
        </mat-tab>
      </mat-tab-group>
      <br>
      <div *ngIf="selected.value == 0" class="fl-row button-large justify-end">
        <button *ngIf="auth.isBuyFirst && editId > 0" class="btn-analise large" mat-raised-button (click)="openThermometer()">
          Analise
        </button>
        <button *ngIf="editId" class="btn-products large" mat-raised-button (click)="openProducts()">
          Gerenciar Produtos
        </button>
        <button *ngIf="allowEntry" class="large" mat-raised-button color="primary" (click)="save()" [style.color]="'white'">
          Salvar
        </button>
      </div>
    </div>
